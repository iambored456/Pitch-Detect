<!doctype html>
<html>
<head>
  <title>Pitch Detector</title>
  <!-- Link to the external CSS file -->
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- Navigation Bar -->
  <nav>
    <div class="nav-container">
      <!-- Left-aligned brand (two lines) -->
      <div class="brand">
        <p class="small-text">Quinn Fleming's</p>
        <h1>Music Learning Tools</h1>
      </div>
      
      <!-- Centered links -->
      <ul>
        <li><a href="https://iambored456.github.io/DiatonicCompass/">DiatonicCompass</a></li>
        <li><a href="https://iambored456.github.io/Student-Notation/">Student-Notation</a></li>
        <li><a href="https://iambored456.github.io/PitchDetect/" class="active">PitchDetect</a></li>
      </ul>

      <!-- Right column is empty for now (can be used for future items) -->
      <div></div>
    </div>
  </nav>

  <!-- Main Control Panel -->
  <div id="controlPanel">

    <!-- Start pitch detection -->
    <button class="startBtn" onclick="startPitchDetect();" aria-label="Start Pitch Detection">Start</button>
    
    <!-- Detector Readout -->
    <div id="detector" class="vague">
      <div><span id="pitch">--</span> Hz</div>
      <div><span id="note">--</span></div>
      <canvas id="output" width="100" height="42"></canvas>
      <div id="detune">
          <span id="detune_amt">--</span>
          <span id="flat">cents &#9837;</span>
          <span id="sharp">cents &#9839;</span>
      </div>
    </div>

    <!-- Tonic & Toggles Box -->
    <div id="tonicBox">
      <label for="tonicSelect">Tonic:</label>
      <!-- Updated to list all 17 pitch classes explicitly -->
      <select id="tonicSelect" aria-label="Select Tonic">
        <option value="C">C</option>
        <option value="C♯">C♯</option>
        <option value="D♭">D♭</option>
        <option value="D">D</option>
        <option value="D♯">D♯</option>
        <option value="E♭">E♭</option>
        <option value="E">E</option>
        <option value="F">F</option>
        <option value="F♯">F♯</option>
        <option value="G♭">G♭</option>
        <option value="G">G</option>
        <option value="G♯">G♯</option>
        <option value="A♭">A♭</option>
        <option value="A">A</option>
        <option value="A♯">A♯</option>
        <option value="B♭">B♭</option>
        <option value="B">B</option>
      </select>

      <!-- Degrees checkbox -->
      <label>
        <input type="checkbox" id="labelToggle" />
        degrees
      </label>

      <!-- Show Accidentals toggle -->
      <label>
        <input type="checkbox" id="accidentalsToggle" />
        Show Accidentals
      </label>
    </div>

    <!-- Drone Box -->
    <div id="droneBox">
      <button class="droneBtn" id="droneBtn">Drone</button>
      
      <div id="octaveToggles">
        <button class="octaveBtn" id="oct2Btn">Oct 2</button>
        <button class="octaveBtn active" id="oct3Btn">Oct 3</button>
        <button class="octaveBtn" id="oct4Btn">Oct 4</button>
      </div>

      <div id="volumeContainer">
        <label for="volumeSlider">Volume</label>
        <div id="volumeSliderWrapper">
          <input type="range" id="volumeSlider" min="0" max="100" value="50" />
          <div class="volumeLabels">
            <span>0</span>
            <span>50</span>
            <span>100</span>
          </div>
        </div>
      </div>
    </div>

  </div>

  <!-- Plot + Note Visualization -->
  <div id="plotContainer">
    <canvas id="frequencyPlot" width="1150" height="500"></canvas>
    <canvas id="noteCanvas" width="1150" height="500"></canvas>
  </div>

  <!-- JS Files -->
  <script src="js/globals.js"></script>
  <script src="js/toggles.js"></script>
  <script src="js/drone.js"></script>
  <script src="js/plotAxis.js"></script>
  <script src="js/plotMain.js"></script>
  <script src="js/pitchdetection.js"></script>

  <!-- Inline JS to wire up UI events -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Tonic dropdown
      document.getElementById("tonicSelect").addEventListener("change", function() {
        setTonic(this.value); 
      });

      // Degrees
      document.getElementById("labelToggle").addEventListener("change", function() {
        setLabelMode(this.checked);
      });

      // Show Accidentals
      document.getElementById("accidentalsToggle").addEventListener("change", function() {
        setAccidentalsVisibility(this.checked);
      });

      // Drone button
      const droneBtn = document.getElementById("droneBtn");
      droneBtn.addEventListener("click", function() {
        toggleDrone(); // your function in drone.js
      });

      // Octave toggles
      const oct2Btn = document.getElementById("oct2Btn");
      const oct3Btn = document.getElementById("oct3Btn");
      const oct4Btn = document.getElementById("oct4Btn");

      [oct2Btn, oct3Btn, oct4Btn].forEach(btn => {
        btn.addEventListener("click", function() {
          setDroneOctave(this);
        });
      });

      // Volume slider
      const volumeSlider = document.getElementById("volumeSlider");
      volumeSlider.addEventListener("input", function() {
        let vol = parseInt(this.value, 10);
        setDroneVolume(vol);
      });
    });
  </script>
</body>
</html>
